'--- SELECT PLAYER MAIN BLOCK ---

'MODE 7,16

IF NOINTRO=0 THEN

 PAGE WRITE 0: CLS RGB(0,0,0)
 PAGE WRITE 1: CLS RGB(0,0,0): LOAD PNG ".\IMAGES\INTRO\SELECT_PLAYER.PNG"

 PAGE COPY 1 TO 2,I      'COPY TO ANOTHER PAGE
 PAGE WRITE 2
 BOX   8,39,90,112,1,0,0  'CLEAR PLAYER PHOTOS
 BOX 115,39,90,112,1,0,0  'CLEAR PLAYER PHOTOS

 'CLEAR ALL SELECTIONS
 PAGE WRITE 1
 BOX   0, 31,320,  8,1,0,0
 BOX   0, 31,  8,120,1,0,0
 BOX  98, 31, 17,120,1,0,0
 BOX 205, 31, 17,120,1,0,0
 BOX 312, 31,  8,120,1,0,0
 BOX   0,151,320, 16,1,0,0

 PLAY_WAV "Character Select"
 FadeIn

 PAGE COPY 1 TO 3

ENDIF

'INITIAL MAX PLAYERS
MAXPL=1

'LOCK CONTROL (USED AS TEMPORAY VARIABLE)
X(1)=0: X(2)=0
'CHOOSED PLAYER (TEMPORARY)
Y(1)=99: Y(2)=99

'CLEAR BUFFER
IF CtrlType(PL)=1 THEN Classic_Mini_Read(CtrlExist(1))

MAXPL=1

DO
 IF NOINTRO THEN EXIT DO 
 INC PL: IF PL>MAXPL THEN PL=1

 'ENTER THE SECOND PLAYER
 IF MAXPL=1 THEN
  IF CtrlType(2)=1 THEN
   Classic_Mini_Read(CtrlExist(1))
   IF (PEEK(VAR KCM$, 06)=48 OR PEEK(VAR KCM$, 10)=48 OR PEEK(VAR KCM$, 12)=48) AND Y(PL)=0 THEN
    MAXPL=2: PLAY_SAMPLE 2,2: Y(2)=99
    IF PLType(2)=PLType(1) THEN INC PLType(2): IF PLType(2)>3 THEN PLType(2)=1
   ENDIF
  ENDIF
 ENDIF

'BOX 7+107*(PLType(PL)-1),38,92,114,1,RGB(255,255,255)

 PAGE WRITE 1
 'GET AND SHOWS THE FRAME SELECT 
 BLIT 107*(PL-1),31,107*(PLType(PL)-1),31,106,136,2,4

 'COPY THE VIDEO PAGES ONLY WHEN SCANNING PLAYERS ARE DONE
 IF PL=MAXPL THEN
  PAGE COPY 1 TO 0,I
  PAGE COPY 3 TO 1
 ENDIF

 'ALL PLAYERS WAS SELECTED?
 I=1
 FOR T=1 TO MAXPL
  IF Y(T)<>2 THEN I=0
 NEXT T
 IF I=1 THEN EXIT DO

 IF Y(PL)=2 THEN CONTINUE DO
 IF Y(PL)=1 THEN PLAY_SAMPLE 3,PL: Y(PL)=2
 SELECT CASE CtrlType(PL)
  CASE 0: 'KEYBOARD CONTROL -------------------------------------------------------------
   FOR T=1 TO 6
    KB=ASC(UCASE$(CHR$(KEYDOWN(T))))
    IF X(PL)=0 AND Y(PL)=0 THEN 'LOCK THE SELECT AFTER PRESSED THE CONTROL
     SELECT CASE KB
      CASE K_L
       INC PLType(PL),-1:X(PL)=1
       IF MAXPL=2 AND PLType(PL)=PLTYPE(3-PL) THEN INC PLType(PL),-1
      CASE K_R:
       INC PLType(PL)   :X(PL)=1
       IF MAXPL=2 AND PLType(PL)=PLTYPE(3-PL) THEN INC PLType(PL)
      CASE K_SPC: Y(PL)=1
     END SELECT
    ENDIF
   NEXT T
   KB=ASC(UCASE$(CHR$(KEYDOWN(1))))
   'UNLOCK THE SELECT AFTER RELEASE THE CONTROL
   IF KB<>K_L AND KB<>K_R THEN X(PL)=0
   IF KB<>K_SPC THEN Y(PL)=0

  CASE 1: 'CLASSIC NES/SNES MINI --------------------------------------------------------
   Classic_Mini_Read(CtrlExist(1))
   IF X(PL)=0 AND Y(PL)=0 THEN 'LOCK THE SELECT AFTER PRESSED THE CONTROL
    IF PEEK(VAR KCM$,15)=48 THEN
     INC PLType(PL),-1:X(PL)=1
     IF MAXPL=2 AND PLType(PL)=PLTYPE(3-PL) THEN INC PLType(PL),-1
    ENDIF
    IF PEEK(VAR KCM$, 1)=48 THEN
     INC PLType(PL) :X(PL)=1
     IF MAXPL=2 AND PLType(PL)=PLTYPE(3-PL) THEN INC PLType(PL)
    ENDIF
    IF (PEEK(VAR KCM$, 06)=48 OR PEEK(VAR KCM$, 10)=48 OR PEEK(VAR KCM$, 12)=48) AND Y(PL)=0 THEN Y(PL)=1
   ENDIF
   'UNLOCK THE SELECT AFTER RELEASE THE CONTROL
   IF PEEK(VAR KCM$,15)<>48 AND PEEK(VAR KCM$, 1)<>48 THEN X(PL)=0
   IF PEEK(VAR KCM$,06)<>48 AND PEEK(VAR KCM$,10)<>48 AND PEEK(VAR KCM$, 12)<>48 THEN Y(PL)=0

 END SELECT
 IF X(PL)=1 THEN X(PL)=2: PLAY_SAMPLE 1,PL

 IF Y(PL)=1 THEN
  'MARK THE SELECTED PLAYER
  PAGE WRITE 2
  BOX OR_PIXELS 107*(1-(PLType(PL)-1)),31,106,136,RGB(40,40,40)
  BOX 107*(1-(PLType(PL)-1))+8,31+8,106-16,136-24,1,0,0
 ENDIF

 IF PLType(PL)<1 THEN PLType(PL)=3
 IF PLType(PL)>3 THEN PLType(PL)=1

LOOP ' END SELECT PLAYER ----------------------------------------------------------------
PAUSE(700)
FadeOut
PLAY STOP

