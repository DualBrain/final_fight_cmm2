' --- GENERAL OBJECTS ROUTINES ---

 
' SPAWN NEW OBJECT

SUB SpawnObject(x,y,tp,NUM,IT)
 LOCAL T
 NUM=0

 FOR T=10 TO EMAX
  IF STE(T)=0 THEN
   IF tp=0 THEN EXIT SUB
   'GENERIC START PARAMETERS
   Eside(T)=4   
   EX(T)=x: RealY(T)=y: EY(T)=0: EType(T)=tp
   EAniDelay(T)=0:EAniSpd(T)=5: EWait(T)=0: EItem(T)=IT
   EMV(T)=0: EBACK(T)=1: EHIT(T)=0
   ESJMP(T)=0: STE(T)=1
   ESPDX(T)=0: ESPDY(T)=0: ETR(T)=0: ECOMBO(T)=0
   ES_SPD(T)=3: ESPD(T)=ES_SPD(T): ES_DEF(T)=0: ES_POW(T)=0
   EEnMAX(T)=20: EEnergy(T)=EEnMAX(T)
   NUM=T

   IF tp=-4 THEN tp=-(INT(RND*2.99)+1)          'RANDOM

   IF tp=-1 THEN Etype(T)=100+INT(RND*13.99)    'RANDOM POINTS
   IF tp=-2 THEN Etype(T)=121+INT(RND*19.99)    'RANDOM FOOD
   IF tp=-3 THEN Etype(T)=150+10*INT(RND*2.99)  'RANDOM WEAPONS

   IF EType(T)>99 AND EType(T)<200 THEN ESJMP(T)=-6 'JUMPING FOOD / POINTS / WEAPONS
  
   SELECT CASE Etype(T) 
    CASE 1,2: EAN(T)= 24   'INTACT DRUMCAN
    CASE   3: EAN(T)= 25   'SUPERIOR PIECE OF A BROKEN DRUMCAN
    CASE   4: EAN(T)= 26   'INFERIOR PIECE OF A BROKEN DRUMCAN

    CASE   5: EAN(T)= 27                   'INTACT TELEPHONE BOOTH
    CASE   6: EAN(T)= 28: EEnergy(NUM)=25  'SUPERIOR PIECE OF A BROKEN TELEPHONE BOOTH
    CASE   7: EAN(T)= 29: EEnergy(NUM)=25  'INFERIOR PIECE OF A BROKEN TELEPHONE BOOTH

    CASE   8: EAN(T)= 30                   'INTACT BARREL
    CASE   9: EAN(T)= 31: EEnergy(NUM)=15  'SUPERIOR PIECE OF A BROKEN BARREL
    CASE  10: EAN(T)= 32: EEnergy(NUM)=20  'INFERIOR PIECE OF A BROKEN BARREL

    CASE  11: EAN(T)= 33                   'INTACT DUSTBIN
    CASE  12: EAN(T)= 34: EEnergy(NUM)=40  'SMASHED DUSTBIN

    CASE  13: EAN(T)= 35                   'INTACT TIRES
    CASE  14: EAN(T)= 36: EEnergy(NUM)=25  'NORMAL TIRE
    CASE  15: EAN(T)= 37: EEnergy(NUM)=25  'ROTATED TIRE
    CASE  16: EAN(T)= 38: EEnergy(NUM)=25  'INCLINED TIRE

    CASE  17: EAN(T)= 39                   'INTACT FREIGHT
    CASE  18: EAN(T)= 40: EEnergy(NUM)=20  'INFERIOR PIECE OF A BROKEN FREIGHT

    CASE  19: EAN(T)= 41                   'INTACT BILLBOARD ANIMATION 1
    CASE  20: EAN(T)= 42                   'INTACT BILLBOARD ANIMATION 2
    CASE  21: EAN(T)= 43: EEnergy(NUM)=25  'INFERIOR PIECE OF A BROKEN BILLBOARD

    'ROLLING DRUMCAN
    CASE  34: EAN(T)= 50: ESPDX(T)= 8: ESJMP(T)=-4 'TO THE RIGHT
    CASE  35: EAN(T)= 50: ESPDX(T)=-8: ESJMP(T)=-4 'TO THE LEFT

    'POINTS
    CASE 100: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'NAPKIN
    CASE 101: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'HAT
    CASE 102: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'HAMMER
    CASE 103: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'RADIO
    CASE 104: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1500   'TOPAZ
    CASE 105: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'YEN
    CASE 106: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'DOLLAR
    CASE 107: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'WATCH
    CASE 108: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'OPAL
    CASE 109: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'PERL
    CASE 110: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'EMERALD
    CASE 111: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'RUBY
    CASE 112: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'GOLD BAR
    CASE 113: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'DIAMOND
    'FOOD
    CASE 120: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'GUM
    CASE 121: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'GUM
    CASE 122: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'SOFT DRINK
    CASE 123: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'SOFT DRINK
    CASE 124: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'BEER
    CASE 125: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'BEER
    CASE 126: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'BEER
    CASE 127: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'WHISKY
    CASE 128: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'APPLE
    CASE 129: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'BANANA
    CASE 130: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'GRAPES
    CASE 131: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'ORANGE
    CASE 132: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'PINEAPPLE
    CASE 133: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'HOT DOG
    CASE 134: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'HAMBURGER
    CASE 135: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'SUSHI
    CASE 136: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'CURRY
    CASE 137: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'PIZZA
    CASE 138: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'STEAK
    CASE 139: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'CHICKEN
    CASE 140: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'BARBECUE
    'WEAPONS
    CASE 150: EAN(T)=280: EMV(T)=3     'KATANA ON THE GROUND
    CASE 151: EAN(T)=281: ESJMP(T)=-10 'DROPPING KATANA
    CASE 160: EAN(T)=290: EMV(T)=3     'KNIFE ON THE GROUND
    CASE 161: EAN(T)=291: ESJMP(T)=-10 'DROPPING KNIFE
    CASE 164: EAN(T)=299: EMV(T)=1:EEnergy(NUM)=999:ESPDX(T)= 16:EY(T)=-50 'THROWED KNIFE TO RIGHT
    CASE 165: EAN(T)=299: EMV(T)=1:EEnergy(NUM)=999:ESPDX(T)=-16:EY(T)=-50 'THROWED KNIFE TO LEFT
    CASE 170: EAN(T)=300: EMV(T)=3     'PIPE ON THE GROUND
    CASE 171: EAN(T)=301: ESJMP(T)=-10 'DROPPING PIPE
    'BROKEN PIECES
    CASE 200: EAN(T)=200: EEnergy(NUM)=35  'PIECES OF GLASS
    CASE 201: EAN(T)=208: EEnergy(NUM)=30  'PIECES OF WOOD 1
    CASE 202: EAN(T)=212: EEnergy(NUM)=30  'PIECES OF WOOD 2
    CASE 203: EAN(T)=216: EEnergy(NUM)=30  'PIECES OF WOOD 3
    CASE 204: EAN(T)=220: EEnergy(NUM)=30  'PIECES OF WOOD 4

    'MOLOTOV
    CASE 210,211: EAN(T)=250: EEnergy(NUM)=999: EAniSpd(T)=2: ESJMP(T)=-12
    'MOLOTOV FIRE
    CASE 212: EAN(T)=260: EEnergy(NUM)=80: EAniSpd(T)=0: EMV(T)=1

   END SELECT
   EXIT SUB
  ENDIF
 NEXT T
END SUB


' CONTROL OBJECT ON THE SCREEN

SUB ControlObject(T)
 LOCAL I,II,TT,NUM

 IF EMV(T)>0 AND EMV(T)<3 THEN INC EEnergy(T),-1 'MAKE IT FLASH TO DISSAPPEAR
 IF EEnergy(T)<10 THEN EMV(T)=2     
 IF EEnergy(T)< 0 THEN STE(T)=0: EXIT SUB        'REMOVE OBJECT

 IF EX(T)<-30 THEN EEnergy(T)=-1

 IF EX(T)>R_SCR THEN EX(T)=R_SCR

 INC EX(T),ESPDX(T)

 'GRAVITY
 IF ETYPE(T)<>212 AND EAN(T)<>299 THEN INC EY(T),ESJMP(T) 'MOLOTOV FIRE / KNIFE DOESN'T HAVE GRAVITY

 IF EY(T)>0 THEN 
  EY(T)=0: IF ESJMP(T)>3 THEN ESJMP(T)=-ESJMP(T)/2 ELSE ESJMP(T)=0
  'POINTS, FOOD AND WEAPONS DON'T MAKE SMOKE
  IF ETYPE(T)<100 OR ETYPE(T)>199 THEN InsertHit(EX(T),RealY(T),2)
 ENDIF

 IF ESJMP(T)<>0 THEN INC ESJMP(T),1.1: IF ESJMP(T)>10 THEN ESJMP(T)=10

 ' SCAN ONLY IF IT'S A INTACT OBJECT 
 IF EMV(T)=0 THEN
  'READ COLLISION - COLLIDED WITH AN THROWED ENEMY? IS_TR = IS THROWED?
  PutObject(EX(T),RealY(T)+EY(T),EAN(T),ESide(T))
  IS_TR=0
  'WHICH SIDE THE ENEMY MUST FALL?
  IF COLLIDE(0)=&HFF00FF THEN ETR(T)=-1: IS_TR=1
  IF COLLIDE(0)=&HFF00BF THEN ETR(T)= 1: IS_TR=1

  ' IF BROKEN BY ANY PLAYER (I) ----------------------------------------------------------
  FOR I=1 TO MAXPL ' * SCAN FOR BOTH PLAYERS *
   ' CONDITIONS TO BE BROKEN:
   ' 1 - DETECTED COLLISION PLAYER'S ATTACK (&HFF0000) OR IS_TR
   IF (COLLIDE(I)=&HFF0000 OR IS_TR) THEN
    Hit(I)=-EAN(T): EHIT(T)=I: ShowHit(I)=70
    InsertHit(XTHit,YTHit,1)
    IF IS_TR=0 THEN InsertWait(I,T,2): INC SCORE(I),100: Combo(I)=0
    INC EEnergy(T),-100
    STE(T)=10: EAniDelay(T)=0: EAniSpd(T)=10
    EAniDelay(T)=0: EAniSpd(T)=1
    ESJMP(T)=-10
    ESIDE(T)=(Side(I)=5)*5+(Side(I)=4)*4
    IF ETR(T)<>0 THEN ESIDE(T)=(ETR(T)=-1)*5+(ETR(I)=1)*4
    ESPDX(T)=(ESIDE(T)=4)*10-(ESIDE(T)=5)*10
   ENDIF

  NEXT I ' * END OF PLAYER SCAN *

 ELSE IF EMV(T)=3 THEN

  ' GET ITEM
  PutObject(EX(T),RealY(T)+EY(T),EAN(T),ESide(T))
  FOR I=1 TO MAXPL
   IF COLLIDE(I)=&H00FF00 AND EAN(T)>=100 THEN ITEM(I)=T
  NEXT I

 ENDIF

 ' SELECT THE OBJECT TYPE ---------------------------------------------------------------

 SELECT CASE EType(T)

  CASE 200       : Object_PIECES_GLASS(T): EXIT SUB
  CASE 201 TO 204: Object_PIECES_WOOD(T): EXIT SUB
  CASE 212       : Object_MOLOTOV_FIRE(T): EXIT SUB

  CASE   1 TO  2 : Object_DRUMCAN(T): EXIT SUB
  CASE   5       : Object_TEL_BOOTH(T): EXIT SUB
  CASE   8,17,19 : Object_BARREL_FR_BL(T): EXIT SUB
  CASE  11       : Object_DUSTBIN(T): EXIT SUB
  CASE  13       : Object_TIRES(T): EXIT SUB
  CASE  34,35    : Object_ROLLING_DRUMCAN(T): EXIT SUB
  CASE 100 TO 119: Object_POINTS(T): EXIT SUB
  CASE 120 TO 140: Object_FOOD(T): EXIT SUB
  CASE 150       : Object_KATANA_GND(T): EXIT SUB
  CASE 151       : Object_KATANA_DROP(T): EXIT SUB
  CASE 160       : Object_KNIFE_GND(T): EXIT SUB
  CASE 161       : Object_KNIFE_DROP(T): EXIT SUB
  CASE 164,165   : Object_KNIFE_THROW(T): EXIT SUB
  CASE 170       : Object_PIPE_GND(T): EXIT SUB
  CASE 171       : Object_PIPE_DROP(T): EXIT SUB
  CASE 210 TO 211: Object_MOLOTOV(T): EXIT SUB

 END SELECT 'END OF OBJECT TYPE

END SUB


' INSERT A HIT
SUB InsertHit(x,y,tp)
 LOCAL T
 FOR T=0 TO 9
  IF AHit(T)=0 THEN
   XHit(T)=x: YHit(T)=y:SDHit(T)=4
   'SET THE START AND THE END OF THE HIT SHAPE / HIT SPEED
   SELECT CASE tp 
    CASE 1: AHit(T)=  1: EnHit(T)=  2: SPHit(T)=0.500 'SPARKLE HIT
    CASE 2: AHit(T)=  3: EnHit(T)= 13: SPHit(T)=1.000 'SMOKE
    CASE 3: AHit(T)= 14: EnHit(T)= 23: SPHit(T)=0.075 'GO! GO!
    CASE 4: AHit(T)=270: EnHit(T)=272: SPHit(T)=0.250 'BLOOD RIGHT
    CASE 5: AHit(T)=270: EnHit(T)=272: SPHit(T)=0.250: SDHit(T)=5 'BLOOD LEFT
   END SELECT
   EXIT SUB
  ENDIF
 NEXT T
END SUB


' HIT ANIMATION ROUTINE
SUB HitAnimation
 LOCAL T
 FOR T=0 TO 9
  IF AHit(T)>0 THEN
   IF AHIT(T)>0 THEN PutObject(XHit(T),YHit(T),INT(AHit(T)),SDHit(T)) 'INSERT SHAPE
   INC AHit(T),SPHit(T)
   IF SPHit(T)=0.075 AND AHit(T)<=INT(AHit(T))+SPHit(T) AND AHit(T)<=EnHit(T) THEN PLAY_SAMPLE 12,3
   IF INT(AHit(T))>=EnHit(T)+1 THEN AHit(T)=0 'END ANIMATION
  ENDIF
 NEXT T
END SUB


'DRUMCAN WITH ITEM / WITHOUT ITEM
SUB Object_DRUMCAN(T)

 SELECT CASE STE(T)
  ' INTACT
  CASE  1:
   EAN(T)=24

   'KICKED
   IF COLLIDE(0)=&HFF0000 AND OSDX=0 THEN STE(T)=10: ESIDE(T)=4 
   IF COLLIDE(0)=&HFFFF00 AND OSDX=0 THEN STE(T)=10: ESIDE(T)=5

  ' REMOVE AND CREATE TWO PIECES
  CASE 10:
   PLAY_SAMPLE 9,4,22050
   SpawnObject(EX(T),RealY(T)+8,30+ESIDE(T))
   STE(T)=0
 END SELECT

END SUB


'TELEPHONE BOOTH
SUB Object_TEL_BOOTH(T)
 LOCAL XC,YC

 SELECT CASE STE(T)
  ' INTACT
  CASE  1: EAN(T)=27
  ' REMOVE AND CREATE TWO PIECES
  CASE 10:
   SpawnObject(EX(T),RealY(T),EITEM(T))
   INC SCORE(EHIT(T)),1500
   SpawnObject(EX(T),RealY(T),6,NUM): EY(NUM)=EY(T)-64
   ESJMP(NUM)=ESJMP(T)-5: ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
   SpawnObject(EX(T),RealY(T),7,NUM)
   ESJMP(NUM)=ESJMP(T)  : ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
   FOR XC=-1 TO 1 STEP 2
    FOR YC=-1 TO 1
     SpawnObject(EX(T),RealY(T),200,NUM): EY(NUM)=EY(T)-40+YC*10
     ESJMP(NUM)=ESJMP(T)-6+RND*4: ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
     ESPDX(NUM)=XC*2+(RND*6-3)*XC
   NEXT YC,XC
   STE(T)=0
   PLAY_SAMPLE 1,4,22050
 END SELECT

END SUB


'BARREL / FREIGHT / BILLBOARD
SUB Object_BARREL_FR_BL(T)
 LOCAL XC,YC

 SELECT CASE STE(T)
  ' INTACT
  CASE  1: EAN(T)=30+(EType(T)=17)*9+(EType(T)=19)*11+(EType(T)=19)*SW
  ' REMOVE AND CREATE TWO PIECES
  CASE 10:
   SpawnObject(EX(T),RealY(T),EITEM(T))
   INC SCORE(EHIT(T)),900
   SpawnObject(EX(T),RealY(T),10+(EType(T)=17)*8+(EType(T)=19)*11,NUM)
   ESJMP(NUM)=ESJMP(T)/2: ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
   FOR XC=-1 TO 1 STEP 2
    FOR YC=-1 TO 1
     SpawnObject(EX(T),RealY(T),201+INT(RND*3.99),NUM): EY(NUM)=EY(T)-40+YC*10
     ESJMP(NUM)=ESJMP(T)-6+RND*4: ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
     ESPDX(NUM)=XC*2+(RND*6-3)*XC
   NEXT YC,XC
   STE(T)=0
   PLAY_SAMPLE 2,4,22050
 END SELECT

END SUB


'DUSTBIN
SUB Object_DUSTBIN(T)

 SELECT CASE STE(T)
  ' INTACT
  CASE  1: EAN(T)=33
  ' REMOVE AND EXCHANGE FOR THE SMASHED
  CASE 10:
   SpawnObject(EX(T),RealY(T),EITEM(T))
   INC SCORE(EHIT(T)),600
   SpawnObject(EX(T),RealY(T),12,NUM): EY(NUM)=EY(T)-8
   ESJMP(NUM)=ESJMP(T): ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)*1.3:EMV(NUM)=1
   STE(T)=0
   PLAY_SAMPLE 3,4,26000
 END SELECT

END SUB


'TIRES
SUB Object_TIRES(T)

 SELECT CASE STE(T)
  ' INTACT
  CASE  1: EAN(T)=35
  ' REMOVE AND EXCHANGE FOR THE SMASHED
  CASE 10:
   SpawnObject(EX(T),RealY(T),EITEM(T))
   INC SCORE(EHIT(T)),600
   SpawnObject(EX(T),RealY(T),14,NUM): EY(NUM)=EY(T)-8
   ESJMP(NUM)=ESJMP(T)-5: ESIDE(NUM)=ESIDE(T)+2: ESPDX(NUM)=ESPDX(T)/1.1:EMV(NUM)=1
   SpawnObject(EX(T),RealY(T),16,NUM): EY(NUM)=EY(T)-8
   ESJMP(NUM)=ESJMP(T)-2: ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)/1.2:EMV(NUM)=1
   SpawnObject(EX(T),RealY(T),15,NUM): EY(NUM)=EY(T)-8
   ESJMP(NUM)=ESJMP(T)  : ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)/1.25:EMV(NUM)=1
   SpawnObject(EX(T),RealY(T),16,NUM): EY(NUM)=EY(T)-8
   ESJMP(NUM)=ESJMP(T)+2: ESIDE(NUM)=(ESIDE(T)=4)*5+(ESIDE(T)=5)*4: ESPDX(NUM)=ESPDX(T)/1.3:EMV(NUM)=1
   STE(T)=0
   PLAY_SAMPLE 3,4,18000
 END SELECT

END SUB


'ROLLING DRUMCAN
SUB Object_ROLLING_DRUMCAN(T)
 LOCAL I

 SELECT CASE STE(T)
  ' MOVING
  CASE  1:
   IF EX(T)>MM.HRES+30 THEN EEnergy(T)=-1
   IF SB THEN INC EAN(T),SGN(ESPDX(T))
   IF EAN(T)<50 THEN EAN(T)=57
   IF EAN(T)>57 THEN EAN(T)=50

   'PLAYER HURTED
   FOR I=1 TO MAXPL    
    IF RealY(T)>RealY(I)-7 AND RealY(T)+20<RealY(I)+7 THEN
     IF X(I)+24>EX(T) AND X(I)-24<EX(T) AND PHurted(I)=0 THEN
      PHurted(I)=3
      INC HCombo(I),250: INC Energy(I),-15
      PLAY_SAMPLE 3,I,20000
     ENDIF
    ENDIF
   NEXT I
   'ENEMY HURTED
   FOR I=4 TO 9
    IF STE(I)>0 THEN
     IF RealY(T)>RealY(I)-7 AND RealY(T)+20<RealY(I)+7 THEN
      IF EX(T)+24>EX(I) AND EX(T)-24<EX(I) AND EBURNED(I)=0 AND STE(I)<50 THEN
       INC EEnergy(I),-15
       STE(I)=51: EAniSpd(I)=40: EANiDelay(I)=0: ESJMP(I)=-10: EAN(I)=23
       ESPDY(I)=0: PLAY_SAMPLE 3,4,20000
      ENDIF
     ENDIF
    ENDIF
   NEXT I

  ' REMOVE AND EXCHANGE FOR THE SMASHED
  CASE 10:
   SpawnObject(EX(T),RealY(T),EITEM(T))
   INC SCORE(EHIT(T)),900
   SpawnObject(EX(T),RealY(T),3,NUM): EY(NUM)=EY(T)-46
   ESJMP(NUM)=ESJMP(T)    : ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)    :EMV(NUM)=1
   SpawnObject(EX(T),RealY(T),4,NUM)
   ESJMP(NUM)=ESJMP(T)/1.3: ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)/1.2:EMV(NUM)=1
   STE(T)=0
   PLAY_SAMPLE 3,4,20000
 END SELECT

END SUB


'POINTS
SUB Object_POINTS(T)

 IF STE(T)=99 THEN
  Hit(EHIT(T))=-EAN(T): ShowHit(EHIT(T))=70
  INC SCORE(EHIT(T)),ESCORE(T)
  STE(T)=0
 ENDIF

END SUB


'FOOD
SUB Object_FOOD(T)

 IF STE(T)=99 THEN
  Hit(EHIT(T))=-EAN(T): ShowHit(EHIT(T))=70
  INC SCORE(EHIT(T)),ESCORE(T)
  INC Energy(EHIT(T)),ESCORE(T)/100
  IF Energy(EHIT(T))>110 THEN Energy(EHIT(T))=110
  STE(T)=0
 ENDIF

END SUB


'KATANA ON THE GROUND
SUB Object_KATANA_GND(T)

 IF STE(T)=99 THEN
  Hit(EHIT(T))=-EAN(T): ShowHit(EHIT(T))=70
  IF Weapon(EHIT(T))>0 THEN SpawnObject(X(EHIT(T)),RealY(EHIT(T)),Weapon(EHIT(T))): EY(NUM)=0
  Weapon(EHIT(T))=KATANA
  STE(T)=0
 ENDIF

END SUB


'KATANA DROPPED
SUB Object_KATANA_DROP(T)

 INC EAN(T)
 IF EAN(T)>288 THEN EAN(T)=281
 IF EY(T)=0 THEN STE(T)=0: SpawnObject(EX(T),RealY(T),KATANA)

END SUB


'KNIFE ON THE GROUND
SUB Object_KNIFE_GND(T)

 IF STE(T)=99 THEN
  Hit(EHIT(T))=-EAN(T): ShowHit(EHIT(T))=70
  IF Weapon(EHIT(T))>0 THEN SpawnObject(X(EHIT(T)),RealY(EHIT(T)),Weapon(EHIT(T))): EY(NUM)=0
  Weapon(EHIT(T))=KNIFE
  STE(T)=0
 ENDIF

END SUB


'THROWED KNIFE
SUB Object_KNIFE_THROW(T)
 LOCAL I

 EY(T)=-50
 ESIDE(T)=4+(ESPDX(T)<0)

 'PLAYER HURTED
 FOR I=1 TO MAXPL    
  IF RealY(T)>RealY(I)-7 AND RealY(T)<RealY(I)+7 THEN
   IF (COLLIDE(0)=&HFFFFFF) AND PHurted(I)=0 AND AN(I)<>71 THEN
    PHurted(I)=3: STE(T)=0
    INC HCombo(I),250: INC Energy(I),-20
    PLAY_SAMPLE 24,I    
    InsertHit(EX(T),RealY(T)+EY(T),ESIDE(T)) 'BLOOD
   ENDIF
  ENDIF
 NEXT I
 'ENEMY HURTED
 FOR I=4 TO 9
  IF STE(I)>0 THEN
   IF RealY(T)>RealY(I)-7 AND RealY(T)<RealY(I)+7 THEN
    IF EX(T)+16>EX(I) AND EX(T)-16<EX(I) AND STE(I)<50 THEN
     INC EEnergy(I),-20: STE(T)=0
     STE(I)=51: EAniSpd(I)=20: EANiDelay(I)=0: ESJMP(I)=-10: EAN(I)=23
     ESPDY(I)=0: PLAY_SAMPLE 24,4
     InsertHit(EX(T),RealY(T)+EY(T),ESIDE(T)) 'BLOOD
    ENDIF
   ENDIF
  ENDIF
 NEXT I

 'DEFEATED KNIFE OR REACH A WALL (OR STAGE LIMIT)
 IF STE(T)=99 OR EX(T)>R_SCR OR EX(T)<L_SCR THEN
  PLAY_SAMPLE 29,4,44100
  SpawnObject(EX(T),RealY(T),KNIFE+1): EY(NUM)=-40
  STE(T)=0 
 ENDIF

END SUB



'KNIFE DROPPED
SUB Object_KNIFE_DROP(T)

 INC EAN(T)
 IF EAN(T)>298 THEN EAN(T)=291
 IF EY(T)=0 THEN STE(T)=0: SpawnObject(EX(T),RealY(T),KNIFE)

END SUB


'PIPE ON THE GROUND
SUB Object_PIPE_GND(T)

 IF STE(T)=99 THEN
  Hit(EHIT(T))=-EAN(T): ShowHit(EHIT(T))=70
  IF Weapon(EHIT(T))>0 THEN SpawnObject(X(EHIT(T)),RealY(EHIT(T)),Weapon(EHIT(T))): EY(NUM)=0
  Weapon(EHIT(T))=PIPE
  STE(T)=0
 ENDIF

END SUB


'PIPE DROPPED
SUB Object_PIPE_DROP(T)

 INC EAN(T)
 IF EAN(T)>308 THEN EAN(T)=301
 IF EY(T)=0 THEN STE(T)=0: SpawnObject(EX(T),RealY(T),PIPE)

END SUB


'PIECES OF GLASS
SUB Object_PIECES_GLASS(T)

 INC EAN(T)
 IF EAN(T)>207 THEN EAN(T)=200
 IF EAN(T)<200 THEN EAN(T)=207

END SUB


'PIECES OF WOOD
SUB Object_PIECES_WOOD(T)

 INC EAN(T)
 IF EAN(T)>211+(EType(T)-201)*4 THEN EAN(T)=208+(EType(T)-201)*4
 IF EAN(T)<208+(EType(T)-201)*4 THEN EAN(T)=211+(EType(T)-201)*4

END SUB


'MOLOTOV
'210 - PL1 / 211 - PL2 - WHAT PLAYER THE MOLOTOV IS AIMING?
SUB Object_MOLOTOV(T)

 IF SW THEN INC EAN(T)
 IF EAN(T)>257 THEN EAN(T)=250
 IF RealY(T)>RealY(EType(T)-209)-5 THEN INC RealY(T),-5
 IF RealY(T)<RealY(EType(T)-209)+5 THEN INC RealY(T), 5
 IF EY(T)=0 THEN
  PLAY_SAMPLE 1,4: EEnergy(T)=-99
  InsertHit(EX(T),RealY(T),1)

  FOR II=10 TO 0 STEP -10
   SpawnObject(EX(T)+II*3,RealY(T)+10,212,NUM)
   RealY(NUM)=RealY(T): EMV(NUM)=1: ESIDE(NUM)=4: ES_SPD(NUM)=-II 'FIRE TO RIGHT
   EAN(NUM)=260+(II=10)*5
   SpawnObject(EX(T)-II*3,RealY(T)+10,212,NUM)
   RealY(NUM)=RealY(T): EMV(NUM)=1: ESIDE(NUM)=5: ES_SPD(NUM)=-II 'FIRE TO LEFT
   EAN(NUM)=260+(II=10)*5
  NEXT II
 ENDIF
 IF STE(T)=10 THEN PLAY_SAMPLE 27,4,44100: InsertHit(XTHit,YTHit,1): STE(T)=0

END SUB


'MOLOTOV FIRE
SUB Object_MOLOTOV_FIRE(T)
 LOCAL I

 INC EAN(T),-1
 EY(T)=ES_SPD(T)
 IF EAN(T)<260 THEN
  EAN(T)=269: INC EX(T),(ESIDE(T)=4)*12-(ESIDE(T)=5)*12
  IF ES_SPD(T) THEN ES_SPD(T)=0 ELSE ES_SPD(T)=-10
 ENDIF
 INC EEnergy(T),-1   
 'PLAYER BURNED
 FOR I=1 TO MAXPL    
  IF RealY(T)>RealY(I)-7 AND RealY(T)<RealY(I)+7 THEN
   IF (COLLIDE(0)=&HFFFFFF) AND PHurted(I)=0 THEN
    PHurted(I)=3
    INC HCombo(I),250: INC Energy(I),-15
    Burned(I)=1:: PLAY_SAMPLE 3,I,10000
   ENDIF
  ENDIF
 NEXT I
 'ENEMY BURNED
 FOR I=4 TO 9
  IF STE(I)>0 THEN
   IF RealY(T)>RealY(I)-7 AND RealY(T)<RealY(I)+7 THEN
    IF EX(T)+16>EX(I) AND EX(T)-16<EX(I) AND EBURNED(I)=0 AND STE(I)<50 THEN
     INC EEnergy(I),-15: EBurned(I)=1
     STE(I)=51: EAniSpd(I)=40: EANiDelay(I)=0: ESJMP(I)=-10: EAN(I)=23
     ESPDY(I)=0: PLAY_SAMPLE 3,4,10000
    ENDIF
   ENDIF
  ENDIF
 NEXT I

END SUB


