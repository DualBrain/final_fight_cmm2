' --- GENERAL EVENTS ---

SUB ClearEvents
 LOCAL T
 'RESET ALL STAGE EVENTS, ENEMIES, OBJECTS AND MORE
 MATH SET 0,Event()
 MATH SET 0,EEnergy()
 MATH SET 0,STE()
 MATH SET 0,EX()
 MATH SET 0,EY()
 MATH SET 0,ESJMP()
 MATH SET 0,ETR()
 MATH SET 0,EWAIT()
 MATH SET 0,ESPD()
 MATH SET 0,ESIDE()
 MATH SET 0,EType()
 MATH SET 0,ECOMBO()
 MATH SET 0,EHIT()
 MATH SET 0,ESPDX()
 MATH SET 0,ESPDY()
 MATH SET 0,EBACK()
 MATH SET 0,EBACKX()
 MATH SET 0,EAN()
 MATH SET 0,EAniSpd()
 MATH SET 0,EAniDelay()
 MATH SET 0,EDIST()
 MATH SET 0,EEnergy()
 MATH SET 0,EEnMax()
 MATH SET 0,EMV()
 MATH SET 0,STE()
 MATH SET 0,ES_SPD()
 MATH SET 0,ES_POW()
 MATH SET 0,ES_DEF()
 MATH SET 0,ESCORE()
 MATH SET 0,EITEM()
 MATH SET 0,XHit()
 MATH SET 0,YHit()
 MATH SET 0,AHit()
 MATH SET 0,EnHit()
 MATH SET 0,SPHit()
 MATH SET 0,Event()
 MATH SET 0,Index()
 MATH SET 0,ZBUF()
 MATH SET 0,Y()
 FOR T=4 TO EMAX
  RealY(T)=0
 NEXT T
 Scroll=0
 LevelPart=0
 ScrX=240
 FOR T=34 TO 36
  PAGE WRITE T
  CLS RGB(0,0,0)
 NEXT T
 PAGE WRITE 1
END SUB


' SCROLL THE STAGE AND CALL ROUND EVENTS

SUB StageScrollEvent(xx,PL)
 Local t,i

 'DON'T ALLOW SCROLL FOR A WHILE
 IF ScrollLock>0 THEN INC ScrollLock,-1: xx=0

 xx=int(xx)

 'SCROLL OTHER PLAYERS OR CANCEL SCROLL IF OTHER PLAYER IS IN THE LIMIT OF THE SCREEN
 IF OSDX=0 THEN
  for t=1 to MAXPL
   IF t<>PL THEN INC X(t),-xx
   IF X(t)<20 THEN xx=0: X(t)=0
  next t
 ENDIF

 INC Scroll,xx
 xs=Scroll: MVSCR=1

 'SCROLL ENEMIES
 for t=0 to EMAX
  INC EX(t),-xx
 next t

 'LIMIT OF THE ROUND 
 INC ScrX,xx

 IF ScrX>=LIMRD THEN
  ScrX=LIMRD
  IF CNTE<>0 THEN WaitRound=0
  'LOAD END OF SECTION EVENT ONLY WHEN PLAYERS ARE STOPPED
  IF CNTE=0 AND OSDX<5000 THEN
   INC WaitRound
   IF WaitRound>50 THEN
    GO=1
    FOR T=1 TO MAXPL
     IF Punch(T)>0 OR Kick(T)>0 OR Special(T)>0 OR PHurted(T)>0 OR AN(T)>14 THEN GO=0
    NEXT T
    IF GO THEN OSDX=9990': RoundIntro(1)
   ENDIF
  ENDIF
 ENDIF

 'CREATE HORIZONTAL LIMIT FOR THE ROUND
 R_SCR=LIMRD-ScrX+RSCRX
 L_SCR=LSCRX-(ScrX-240)

 'CALL EACH LEVEL PART UNTIL THE SECTION LIMIT
 if xs>320 then inc xs,-320: inc LevelPart, 1:MVSCR=0
 if xs<  0 then inc xs, 320: inc LevelPart,-1:MVSCR=0
 if LevelPart<0 then xs=0: LevelPart=0

 IF LevelPart>PartMax THEN LevelPart=PartMax: xs=320

 PAGE WRITE 1

 'CALL ROUND EVENTS
 EXECUTE "Round_" + STR$(Round) + "_Events(xx)"

 Scroll=xs

END SUB

