' --- GENERAL OBJECTS ROUTINES ---

 
' INSERT NEW OBJECT
' 1 - DRUMCAN

SUB InsertObject(x,y,tp,NUM,IT)
 LOCAL T
 NUM=0

 FOR T=13 TO EMAX
  IF STE(T)=0 THEN
   IF tp=0 THEN EXIT SUB
   'GENERIC START PARAMETERS
   Eside(T)=4   
   EX(T)=x: RealY(T)=y: EY(T)=0: EType(T)=tp
   EAniDelay(T)=0:EAniSpd(T)=5: EWait(T)=0: EItem(T)=IT
   EMV(T)=0: EBACK(T)=1: EHIT(T)=0
   ESJMP(T)=0: STE(T)=1
   ESPDX(T)=0: ESPDY(T)=0: ETR(T)=0: ECOMBO(T)=0
   ES_SPD(T)=3: ESPD(T)=ES_SPD(T): ES_DEF(T)=0: ES_POW(T)=0
   EEnMAX(T)=20: EEnergy(T)=EEnMAX(T)
   NUM=T

   IF tp=-1 THEN Etype(T)=100+INT(RND*13.99) 'RANDOM POINTS
   IF tp=-2 THEN Etype(T)=121+INT(RND*19.99) 'RANDOM FOOD

   SELECT CASE Etype(T) 
    CASE 1,2: EAN(T)= 24   'INTACT DRUMCAN
    CASE   3: EAN(T)= 25   'SUPERIOR PIECE OF A BROKEN DRUMCAN
    CASE   4: EAN(T)= 26   'INFERIOR PIECE OF A BROKEN DRUMCAN

    CASE   5: EAN(T)= 27                   'INTACT TELEPHONE BOOTH
    CASE   6: EAN(T)= 28: EEnergy(NUM)=25  'SUPERIOR PIECE OF A BROKEN TELEPHONE BOOTH
    CASE   7: EAN(T)= 29: EEnergy(NUM)=25  'INFERIOR PIECE OF A BROKEN TELEPHONE BOOTH

    CASE   8: EAN(T)= 30                   'INTACT BARREL
    CASE   9: EAN(T)= 31: EEnergy(NUM)=15  'SUPERIOR PIECE OF A BROKEN BARREL
    CASE  10: EAN(T)= 32: EEnergy(NUM)=20  'INFERIOR PIECE OF A BROKEN BARREL

    CASE  11: EAN(T)= 33                   'INTACT DUSTBIN
    CASE  12: EAN(T)= 34: EEnergy(NUM)=40  'SMASHED DUSTBIN

    CASE  13: EAN(T)= 35                   'INTACT TIRES
    CASE  14: EAN(T)= 36: EEnergy(NUM)=25  'NORMAL TIRE
    CASE  15: EAN(T)= 37: EEnergy(NUM)=25  'ROTATED TIRE
    CASE  16: EAN(T)= 38: EEnergy(NUM)=25  'INCLINED TIRE

    CASE  17: EAN(T)= 39                   'INTACT FREIGHT
    CASE  18: EAN(T)= 40: EEnergy(NUM)=20  'INFERIOR PIECE OF A BROKEN FREIGHT

    CASE  19: EAN(T)= 41                   'INTACT BILLBOARD ANIMATION 1
    CASE  20: EAN(T)= 42                   'INTACT BILLBOARD ANIMATION 2
    CASE  21: EAN(T)= 43: EEnergy(NUM)=20  'SUPERIOR PIECE OF A BROKEN BILLBOARD
    CASE  22: EAN(T)= 44: EEnergy(NUM)=25  'INFERIOR PIECE OF A BROKEN BILLBOARD
    'POINTS
    CASE 100: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'NAPKIN
    CASE 101: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'HAT
    CASE 102: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'HAMMER
    CASE 103: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'RADIO
    CASE 104: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1500   'TOPAZ
    CASE 105: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'YEN
    CASE 106: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'DOLLAR
    CASE 107: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'WATCH
    CASE 108: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'OPAL
    CASE 109: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'PERL
    CASE 110: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'EMERALD
    CASE 111: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'RUBY
    CASE 112: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'GOLD BAR
    CASE 113: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'DIAMOND
    'FOOD
    CASE 120: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'GUM
    CASE 121: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'GUM
    CASE 122: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'SOFT DRINK
    CASE 123: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'SOFT DRINK
    CASE 124: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'BEER
    CASE 125: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'BEER
    CASE 126: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'BEER
    CASE 127: EAN(T)=EType(T): EMV(T)=3: EScore(T)=1000   'WHISKY
    CASE 128: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'APPLE
    CASE 129: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'BANANA
    CASE 130: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'GRAPES
    CASE 131: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'ORANGE
    CASE 132: EAN(T)=EType(T): EMV(T)=3: EScore(T)=3000   'PINEAPPLE
    CASE 133: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'HOT DOG
    CASE 134: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'HAMBURGER
    CASE 135: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'SUSHI
    CASE 136: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'CURRY
    CASE 137: EAN(T)=EType(T): EMV(T)=3: EScore(T)=5000   'PIZZA
    CASE 138: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'STEAK
    CASE 139: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'CHICKEN
    CASE 140: EAN(T)=EType(T): EMV(T)=3: EScore(T)=10000  'BARBECUE
    'BROKEN PIECES
    CASE 200: EAN(T)=200: EEnergy(NUM)=35  'PIECES OF GLASS
    CASE 201: EAN(T)=208: EEnergy(NUM)=30  'PIECES OF WOOD 1
    CASE 202: EAN(T)=212: EEnergy(NUM)=30  'PIECES OF WOOD 2
    CASE 203: EAN(T)=216: EEnergy(NUM)=30  'PIECES OF WOOD 3
    CASE 204: EAN(T)=220: EEnergy(NUM)=30  'PIECES OF WOOD 4
   END SELECT
   EXIT SUB
  ENDIF
 NEXT T
END SUB


' CONTROL OBJECT ON THE SCREEN

SUB ControlObject(T)
 LOCAL I,II,TT,NUM

 'READ COLLISION WITH ANY PLAYER BUT NOT DRAW THE OBJECT
 PutObject(EX(T),RealY(T)+EY(T),EAN(T),ESide(T),-1)

 IF EX(T)>360 THEN EXIT SUB
 IF EX(T)<-30 THEN EEnergy(T)=-1

 INC EX(T),ESPDX(T)
 IF EX(T)>R_SCR THEN EX(T)=R_SCR
 'GRAVITY
 INC EY(T),ESJMP(T)
 IF ESJMP(T)<>0 THEN INC ESJMP(T),1.1: IF ESJMP(T)>10 THEN ESJMP(T)=10
 IF EY(T)>0 THEN
  InsertHit(EX(T),RealY(T),2)
  EY(T)=0: ESJMP(T)=-ESJMP(T)/2
 ENDIF

 ' SCAN ONLY IF IT'S A INTACT OBJECT 
 IF EMV(T)=0 THEN
  'READ COLLISION - COLLIDED WITH AN THROWED ENEMY? IS_TR = IS THROWED?
  IS_TR=0
  'WHICH SIDE THE ENEMY MUST FALL?
  IF COLLIDE(0)=&HFF00FF THEN ETR(T)=-1: IS_TR=1
  IF COLLIDE(0)=&HFF00BF THEN ETR(T)= 1: IS_TR=1

  ' IF BROKEN BY ANY PLAYER (I) ----------------------------------------------------------
  FOR I=1 TO MAXPL ' * SCAN FOR BOTH PLAYERS *
   ' CONDITIONS TO BE BROKEN:
   ' 1 - DETECTED COLLISION PLAYER'S ATTACK (&HFF0000) OR IS_TR
   IF (COLLIDE(I)=&HFF0000 OR IS_TR) THEN
    Hit(I)=-EAN(T): EHIT(T)=I: ShowHit(I)=70
    InsertHit(XTHit,YTHit,1)
    IF IS_TR=0 THEN InsertWait(I,T,2): INC SCORE(I),100: Combo(I)=0
    INC EEnergy(T),-100
    STE(T)=10: EAniDelay(T)=0: EAniSpd(T)=10
    EAniDelay(T)=0: EAniSpd(T)=1
    ESJMP(T)=-10
    ESIDE(T)=(Side(I)=5)*5+(Side(I)=4)*4
    IF ETR(T)<>0 THEN ESIDE(T)=(ETR(T)=-1)*5+(ETR(I)=1)*4
    ESPDX(T)=(ESIDE(T)=4)*10-(ESIDE(T)=5)*10
   ENDIF

  NEXT I ' * END OF PLAYER SCAN *

 ELSE IF EMV(T)=3 THEN

  ' GET ITEM
  FOR I=1 TO MAXPL
   IF COLLIDE(I)=&H00FF00 AND EAN(T)>=100 THEN ITEM(I)=T
  NEXT I

 ENDIF

 ' SELECT THE OBJECT TYPE ---------------------------------------------------------------
 SELECT CASE EType(T)

  'DRUMCAN WITH ITEM / WITHOUT ITEM
  CASE  1,2: 
   SELECT CASE STE(T)
    ' INTACT
    CASE  1: EAN(T)=24
    ' REMOVE AND CREATE TWO PIECES
    CASE 10:
     InsertObject(EX(T),RealY(T),EITEM(T))
     INC SCORE(EHIT(T)),900
     InsertObject(EX(T),RealY(T),3,NUM): EY(NUM)=EY(T)-46
     ESJMP(NUM)=ESJMP(T)    : ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)    :EMV(NUM)=1
     InsertObject(EX(T),RealY(T),4,NUM)
     ESJMP(NUM)=ESJMP(T)/1.3: ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)/1.2:EMV(NUM)=1
     STE(T)=0
     PLAY_SAMPLE 3,4,20000
   END SELECT

  'TELEPHONE BOOTH
  CASE  5: 
   SELECT CASE STE(T)
    ' INTACT
    CASE  1: EAN(T)=27
    ' REMOVE AND CREATE TWO PIECES
    CASE 10:
     InsertObject(EX(T),RealY(T),EITEM(T))
     INC SCORE(EHIT(T)),1500
     InsertObject(EX(T),RealY(T),6,NUM): EY(NUM)=EY(T)-64
     ESJMP(NUM)=ESJMP(T)-5: ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
     InsertObject(EX(T),RealY(T),7,NUM)
     ESJMP(NUM)=ESJMP(T)  : ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
     FOR II=-2 TO 2
      InsertObject(EX(T),RealY(T),200,NUM): EY(NUM)=EY(T)-40+II*10
      ESJMP(NUM)=ESJMP(T)-6+RND*5: ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
      ESPDX(NUM)=II*2+(RND*6-3)
     NEXT II
     STE(T)=0
     PLAY_SAMPLE 1,4,22050
   END SELECT

  'BARREL / FREIGHT / BILLBOARD
  CASE  8,17,19
   SELECT CASE STE(T)
    ' INTACT
    CASE  1: EAN(T)=30+(EType(T)=17)*9+(EType(T)=19)*11+(EType(T)=19)*SW
    ' REMOVE AND CREATE TWO PIECES
    CASE 10:
     'INSERT SUPERIOR PART IF IT'S A BILLBOARD
     InsertObject(EX(T),RealY(T),EITEM(T))
     INC SCORE(EHIT(T)),900
     IF Etype(T)=19 THEN
      InsertObject(EX(T),RealY(T),21,NUM): EY(NUM)=EY(T)-64
      ESJMP(NUM)=ESJMP(T): ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
     ENDIF
     InsertObject(EX(T),RealY(T),10+(EType(T)=17)*8+(EType(T)=19)*12,NUM)
     ESJMP(NUM)=ESJMP(T)/2: ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
     FOR II=-3 TO 3
      InsertObject(EX(T),RealY(T),201+INT(RND*3.99),NUM): EY(NUM)=EY(T)-40+II*10
      ESJMP(NUM)=ESJMP(T)-6+RND*(6+II*2): ESIDE(NUM)=ESIDE(T): EMV(NUM)=1
      ESPDX(NUM)=II*2+(RND*6-3)
     NEXT II
     STE(T)=0
     PLAY_SAMPLE 2,4,22050
   END SELECT

  'DUSTBIN
  CASE  11: 
   SELECT CASE STE(T)
    ' INTACT
    CASE  1: EAN(T)=33
    ' REMOVE AND EXCHANGE FOR THE SMASHED
    CASE 10:
     InsertObject(EX(T),RealY(T),EITEM(T))
     INC SCORE(EHIT(T)),600
     InsertObject(EX(T),RealY(T),12,NUM): EY(NUM)=EY(T)-8
     ESJMP(NUM)=ESJMP(T): ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)*1.3:EMV(NUM)=1
     STE(T)=0
     PLAY_SAMPLE 3,4,26000
   END SELECT

  'TIRES
  CASE  13: 
   SELECT CASE STE(T)
    ' INTACT
    CASE  1: EAN(T)=35
    ' REMOVE AND EXCHANGE FOR THE SMASHED
    CASE 10:
     InsertObject(EX(T),RealY(T),EITEM(T))
     INC SCORE(EHIT(T)),600
     InsertObject(EX(T),RealY(T),14,NUM): EY(NUM)=EY(T)-8
     ESJMP(NUM)=ESJMP(T)-5: ESIDE(NUM)=ESIDE(T)+2: ESPDX(NUM)=ESPDX(T)/1.1:EMV(NUM)=1
     InsertObject(EX(T),RealY(T),16,NUM): EY(NUM)=EY(T)-8
     ESJMP(NUM)=ESJMP(T)-2: ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)/1.2:EMV(NUM)=1
     InsertObject(EX(T),RealY(T),15,NUM): EY(NUM)=EY(T)-8
     ESJMP(NUM)=ESJMP(T)  : ESIDE(NUM)=ESIDE(T): ESPDX(NUM)=ESPDX(T)/1.25:EMV(NUM)=1
     InsertObject(EX(T),RealY(T),16,NUM): EY(NUM)=EY(T)-8
     ESJMP(NUM)=ESJMP(T)+2: ESIDE(NUM)=(ESIDE(T)=4)*5+(ESIDE(T)=5)*4: ESPDX(NUM)=ESPDX(T)/1.3:EMV(NUM)=1
     STE(T)=0
     PLAY_SAMPLE 3,4,18000
   END SELECT

  'POINTS
  CASE 100 TO 119:
   IF STE(T)=99 THEN
    Hit(EHIT(T))=-EAN(T): ShowHit(EHIT(T))=70
    INC SCORE(EHIT(T)),ESCORE(T)
    STE(T)=0
   ENDIF

  'FOOD
  CASE 120 TO 140:
   IF STE(T)=99 THEN
    Hit(EHIT(T))=-EAN(T): ShowHit(EHIT(T))=70
    INC SCORE(EHIT(T)),ESCORE(T)
    INC Energy(EHIT(T)),ESCORE(T)/100
    IF Energy(EHIT(T))>110 THEN Energy(EHIT(T))=110
    STE(T)=0
   ENDIF

  'PIECES OF GLASS
  CASE 200: 
   INC EAN(T)
   IF EAN(T)>207 THEN EAN(T)=200
   IF EAN(T)<200 THEN EAN(T)=207

  'PIECES OF WOOD
  CASE 201,202,203,204: 
   INC EAN(T)
   IF EAN(T)>211+(EType(T)-201)*4 THEN EAN(T)=208+(EType(T)-201)*4
   IF EAN(T)<208+(EType(T)-201)*4 THEN EAN(T)=211+(EType(T)-201)*4

 END SELECT 'END OF OBJECT TYPE

 IF EMV(T)>0 AND EMV(T)<3 THEN INC EEnergy(T),-1 'MAKE IT FLASH TO DISSAPPEAR
 IF EEnergy(T)<10 THEN EMV(T)=2     
 IF EEnergy(T)< 0 THEN STE(T)=0                  'REMOVE OBJECT

END SUB

